This code has some bugs.
Need to fix it.
